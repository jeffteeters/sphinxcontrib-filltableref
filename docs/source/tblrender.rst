tblrender
=========

The ``tblrender`` directive specifies what a summary table looks like (row and column titles and labels)
but without including referenced values.  It is used in the following way:

.. code-block:: bnf


   .. _<table_name>:

   Title of table
   --------------

   Description of table (displayed only before rendered summary table, not before source
   tables.


   .. tblrender <table_name>
      :description:
         Description of table, displayed before each "source" table, which are
         generated by "tbldata" directives.
      <ptable specification> AND/OR <gridtable specification>


The last line above indicates either a <ptable specification> or a <gridtable specification> or
both.  If both are present, they must specify exactly the same table or an error is generated
(except if the only difference between them is that prefilled-values are included in the
<gridtable specification> table since such values cannot be specified using the
<ptable specification>).  If both specifications are present, the <gridtable specification> is
used to create the table.  Both specifications are described below.
  

ptable specification
....................

<ptable specification> contains:

.. code-block:: bnf

      :rows: <row title>, <row labels>
      :cols: <col title>, <col labels>
      :expanded_col_title: <expanded_col_title>
      :ct_offset: <ct_offset>


The entities in angle brackets are either strings (enclosed in single or double quotes), list of strings
(each element in the list separated by a comma) or an integer.  The entities are:

<row title>
   The title displayed in the top left cell of the table (above the <row labels> which are in the left-most
   column below the <row title>).  Example: "City".

<row labels>
   List of the row labels, each element seperated by a comma.  Example: "New York", "London", "Chicago", ...

<col title>
   The title displayed above the <col labels> in the header of the table.  Example: "Season" (for a
   table showning average temperaure during each season).

<col labels>
   List of the column labels, each element seperated by a comma.  Example: "Spring", "Fall", "Summer", ...

<ct_offset>
   A positive integer specifying the number of columns (counting left to right), for which the <col label> is
   not an instance of the <col title>.  If not specified, the default is one (since the first column contains
   the <row title> which is not an instance of the <col title>).  A value greater
   than one specifies a table in which the header for some columns after the first column have a <col lable>
   that does not appear under the <col title>.  This is used for creating the summary table header.
    
<expanded_col_title>
   This is a string that can be used in place of the <col title> as the column title for the column containing
   values in the source tables (made by the *tbldata* directive).  If the <gridtable specification> is used
   (in addition to the <ptable specification>), then the <expanded_col_title> must match a value that is
   derived from the <gridtable specification>.  This value is formed by first parsing the gridtable to obtain
   the <col title>, <col labels> and <ct_offset>; then combining the first <ct_offset> <column labels> and
   the <col title> separated by " or ".  In other words, what is specified explicitly using the <ptable specification>
   must match the layout given in the <gridtable specification> if both are present.


An example is below:

.. code-block:: rst

   :rows: "Source cell", "basket", "golgi", "granule", "purkinje", "stellate"
   :cols: "Target cell", "Cell count", "basket", "golgi", "granule", "purkinje", "stellate"
   :expanded_col_title: "Cell count or Target cell"
   :ct_offset: 2


gridtable specification
.......................


<gridtable specification> contains a ``:gridLayout:`` parameter followed by a Sphinx grid table.
Pre-filled values can be included in the cells.  An example is below, which has pre-filled values of
"-" along a diagonal:

.. code-block:: rst

   :gridLayout:
      +-------------+----------+------------------------------------------------------------------+
      |             |          |  Target cell                                                     |
      | Source      | Cell     +------------+------------+------------+-------------+-------------+
      | cell        | count    | basket     | golgi      | granule    | purkinje    | stellate    |
      +=============+==========+============+============+============+=============+=============+
      | basket      |          |      -     |            |            |             |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | golgi       |          |            |      -     |            |             |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | granule     |          |            |            |      -     |             |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | purkinje    |          |            |            |            |      -      |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | stellate    |          |            |            |            |             |      -      |
      +-------------+----------+------------+------------+------------+-------------+-------------+



Example
.......

An full example including both types of specifications is:

.. code-block:: rst

   .. _table_loebner_fig2a:
   
   
   Cells and connections in cat
   ----------------------------
   
   The following table provides counts of cells and connections in the cat cerebellum.
   The first two columns (*Source cell* and *Cell count*) are respectively a cell type
   and the count (number) of cells of that type.  The values in the rest of the table
   give the number of connections from the Source cell to Target cells.  These are
   specified as a pair of numbers: FO,FI.  FO is fan-out (number of target cells each
   source cell contacts) and FI is fan-in (number of source cells going to each target
   cell).  Most of the data is from Figure 2 in :cite:`LoebnerEE-1989`, but new data will
   be added.
   
   
   .. tblrender:: table_loebner_fig2a
      :rows: "Source cell", "basket", "golgi", "granule", "purkinje", "stellate"
      :cols: "Target cell", "Cell count", "basket", "golgi", "granule", "purkinje", "stellate"
      :expanded_col_title: "Cell count or Target cell"
      :ct_offset: 2
      :description:
         Values are either a Cell count, or FO,FI where FO is *fan-out* (number of target cells
         each source cell contacts) and FI is *fan-in* (number of source cells going to each
         target cell).
      :gridLayout:
         +-------------+----------+------------------------------------------------------------------+
         |             |          |  Target cell                                                     |
         | Source      | Cell     +------------+------------+------------+-------------+-------------+
         | cell        | count    | basket     | golgi      | granule    | purkinje    | stellate    |
         +=============+==========+============+============+============+=============+=============+
         | basket      |          |      -     |            |            |             |             |
         +-------------+----------+------------+------------+------------+-------------+-------------+
         | golgi       |          |            |      -     |            |             |             |
         +-------------+----------+------------+------------+------------+-------------+-------------+
         | granule     |          |            |            |      -     |             |             |
         +-------------+----------+------------+------------+------------+-------------+-------------+
         | purkinje    |          |            |            |            |      -      |             |
         +-------------+----------+------------+------------+------------+-------------+-------------+
         | stellate    |          |            |            |            |             |      -      |
         +-------------+----------+------------+------------+------------+-------------+-------------+
   

It is rendered as shown below.  The values for some of the cells followed by links to the source
of the value are fill-in during the rendering process.  These values are specified in the "source"
table using the *tbldata* directive which is described and shown on the :ref:`tbldata` page.

.. _table_loebner_fig2a:

Cells and connections in cat
----------------------------
   
The following table provides counts of cells and connections in the cat cerebellum.
The first two columns (*Source cell* and *Cell count*) are respectively a cell type
and the count (number) of cells of that type.  The values in the rest of the table
give the number of connections from the Source cell to Target cells.  These are
specified as a pair of numbers: FO,FI.  FO is fan-out (number of target cells each
source cell contacts) and FI is fan-in (number of source cells going to each target
cell).  Most of the data is from Figure 2 in :cite:`LoebnerEE-1989`, but new data will
be added.
   
.. tblrender:: table_loebner_fig2a
   :rows: "Source cell", "basket", "golgi", "granule", "purkinje", "stellate"
   :cols: "Target cell", "Cell count", "basket", "golgi", "granule", "purkinje", "stellate"
   :expanded_col_title: "Cell count or Target cell"
   :ct_offset: 2
   :description:
      Values are either a Cell count, or FO,FI where FO is *fan-out* (number of target cells
      each source cell contacts) and FI is *fan-in* (number of source cells going to each
      target cell).
   :gridLayout:
      +-------------+----------+------------------------------------------------------------------+
      |             |          |  Target cell                                                     |
      | Source      | Cell     +------------+------------+------------+-------------+-------------+
      | cell        | count    | basket     | golgi      | granule    | purkinje    | stellate    |
      +=============+==========+============+============+============+=============+=============+
      | basket      |          |      -     |            |            |             |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | golgi       |          |            |      -     |            |             |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | granule     |          |            |            |      -     |             |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | purkinje    |          |            |            |            |      -      |             |
      +-------------+----------+------------+------------+------------+-------------+-------------+
      | stellate    |          |            |            |            |             |      -      |
      +-------------+----------+------------+------------+------------+-------------+-------------+
